<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="ComicReader.Views.SettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Configuración" Width="920" Height="640" WindowStartupLocation="CenterOwner"
        Icon="/icono.ico" ResizeMode="NoResize" Background="#0F111316" AllowsTransparency="False">

    <Window.Resources>
        <!-- Comic tokens -->
        <FontFamily x:Key="ComicFont">Segoe UI</FontFamily>
        <SolidColorBrush x:Key="BgBrush" Color="#0B0B0C"/>
        <SolidColorBrush x:Key="PanelBrush" Color="#111217"/>
        <SolidColorBrush x:Key="CardBrush" Color="#12131A"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#FF3B82F6"/>
        <SolidColorBrush x:Key="AccentDarkBrush" Color="#FF2563EB"/>
        <SolidColorBrush x:Key="Positive" Color="#FF00C853"/>
        <SolidColorBrush x:Key="Danger" Color="#FFFF5252"/>
        <SolidColorBrush x:Key="MutedText" Color="#B0BAC4"/>
        <SolidColorBrush x:Key="PanelBorder" Color="#22252A"/>
    <Style x:Key="PrimaryButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="6,0"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentDarkBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Width" Value="110"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="10" Padding="8">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="✦" Margin="0,0,6,0" Foreground="#FFFFFF"/>
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="SecondaryButtonStyle" TargetType="Button" BasedOn="{StaticResource PrimaryButtonStyle}">
            <Setter Property="Background" Value="#202328"/>
            <Setter Property="Foreground" Value="#DDE6F3"/>
            <Setter Property="BorderBrush" Value="#2E3338"/>
        </Style>

        <!-- Toggle switch simple -->
    <Style x:Key="ToggleSwitch" TargetType="CheckBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <Grid Width="46" Height="26">
                            <Border x:Name="bg" CornerRadius="13" Background="#2A2D31" BorderBrush="#1F2226" BorderThickness="1"/>
                            <Ellipse x:Name="knob" Width="20" Height="20" Fill="#FFF5F5F5" Margin="3" HorizontalAlignment="Left"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="bg" Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter TargetName="knob" Property="HorizontalAlignment" Value="Right"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Nav item style con icono -->
    <Style x:Key="NavItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="0,6"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="bd" Background="Transparent" CornerRadius="8" Padding="6">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8A7;" Margin="6,0" Foreground="{StaticResource MutedText}" Width="28" HorizontalAlignment="Center" FontSize="18"/>
                                <ContentPresenter VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#11161A"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#0F2A55"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Ocultar cabecera de pestañas (solo se usa el contenido) -->
        <Style x:Key="NoHeaderTabControlStyle" TargetType="TabControl">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabControl">
                        <ContentPresenter ContentSource="SelectedContent"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="18">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- NAV LATERAL -->
        <Border Grid.Column="0" Background="{StaticResource PanelBrush}" CornerRadius="10" Padding="14" Margin="0,0,12,0">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,12" VerticalAlignment="Center">
                    <TextBlock Text="Configuración" FontSize="18" FontWeight="Bold" Foreground="White" FontFamily="{StaticResource ComicFont}"/>
                </StackPanel>
                <TextBox x:Name="SettingsSearch" Text="" Margin="0,0,0,12" Background="#0F1B24" Foreground="#DDE6F3" Padding="8"/>
                <ListBox x:Name="SectionsList" BorderThickness="0" Background="Transparent" SelectedIndex="{Binding ElementName=Tabs, Path=SelectedIndex, Mode=TwoWay}">
                    <ListBoxItem Style="{StaticResource NavItemStyle}" Content="General"/>
                    <ListBoxItem Style="{StaticResource NavItemStyle}" Content="Lectura"/>
                    <ListBoxItem Style="{StaticResource NavItemStyle}" Content="Apariencia"/>
                    <ListBoxItem Style="{StaticResource NavItemStyle}" Content="Rendimiento"/>
                    <ListBoxItem Style="{StaticResource NavItemStyle}" Content="Archivos"/>
                    <ListBoxItem Style="{StaticResource NavItemStyle}" Content="Avanzado"/>
                </ListBox>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                    <Button Content="Restablecer" Click="ResetDefaults_Click" Style="{StaticResource SecondaryButtonStyle}" Width="120"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- CONTENIDO PRINCIPAL -->
        <Border Grid.Column="1" Background="{StaticResource CardBrush}" CornerRadius="10" Padding="18">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Orientation="Horizontal" Grid.Row="0" VerticalAlignment="Center" Margin="0,0,0,8">
                    <TextBlock Text="Ajustes" FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="  — Personaliza tu experiencia de lectura" Foreground="{StaticResource MutedText}" VerticalAlignment="Center" Margin="12,4,0,0"/>
                </StackPanel>

                <TabControl x:Name="Tabs" Grid.Row="1" Style="{StaticResource NoHeaderTabControlStyle}">
                    <!-- Mantener los mismos TabItem contenidos pero reestilizados ligeramente -->
                    <TabItem Header="General">
                        <StackPanel Margin="6">
                            <TextBlock Text="General" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,12"/>
                            <WrapPanel Orientation="Horizontal" ItemHeight="40" ItemWidth="260">
                                <StackPanel Margin="0,0,12,12">
                                    <TextBlock Text="Recordar última sesión" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding RememberLastSession}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,12,12">
                                    <TextBlock Text="Mostrar número de página" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding ShowPageNumberOverlay}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,12,12">
                                    <TextBlock Text="Ajuste inicial" Foreground="{StaticResource MutedText}"/>
                                    <ComboBox Width="220" SelectedValue="{Binding DefaultFitMode}" SelectedValuePath="Content">
                                        <ComboBoxItem Content="Width"/>
                                        <ComboBoxItem Content="Height"/>
                                        <ComboBoxItem Content="Screen"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Margin="0,0,12,12">
                                    <TextBlock Text="Mostrar indicadores de carga" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding ShowLoadingIndicators}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                            </WrapPanel>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="Lectura">
                        <StackPanel Margin="6">
                            <TextBlock Text="Lectura" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,12"/>
                            <UniformGrid Columns="2" Rows="4" Margin="0,0,0,6">
                                <StackPanel Margin="6">
                                    <TextBlock Text="Modo lectura" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox Content="Sin distracciones" IsChecked="{Binding IsReadingMode}" />
                                </StackPanel>
                                <StackPanel Margin="6">
                                    <TextBlock Text="Modo nocturno" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding IsNightMode}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                                <StackPanel Margin="6">
                                    <TextBlock Text="Scroll continuo" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding EnableContinuousScroll}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                                <StackPanel Margin="6">
                                    <TextBlock Text="Arrastre al hacer zoom" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding EnableZoomPan}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                                <StackPanel Margin="6">
                                    <TextBlock Text="Avance automático" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding AutoAdvancePages}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                                <StackPanel Margin="6">
                                    <TextBlock Text="Intervalo (seg)" Foreground="{StaticResource MutedText}"/>
                                    <TextBox Width="100" Text="{Binding AutoAdvanceInterval}"/>
                                </StackPanel>
                                <StackPanel Margin="6">
                                    <TextBlock Text="Dirección" Foreground="{StaticResource MutedText}"/>
                                    <ComboBox Width="140" SelectedValue="{Binding CurrentReadingDirection}" SelectedValuePath="Content">
                                        <ComboBoxItem Content="LeftToRight"/>
                                        <ComboBoxItem Content="RightToLeft"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Margin="6">
                                    <TextBlock Text="Bucle automático" Foreground="{StaticResource MutedText}"/>
                                    <CheckBox IsChecked="{Binding AutoAdvanceLoop}" Style="{StaticResource ToggleSwitch}"/>
                                </StackPanel>
                            </UniformGrid>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="Apariencia">
                        <StackPanel Margin="6">
                            <TextBlock Text="Apariencia" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,12"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Tema" Foreground="{StaticResource MutedText}" Width="140"/>
                                <ComboBox Width="200" SelectedValue="{Binding Theme}" SelectedValuePath="Content">
                                    <ComboBoxItem Content="Dark"/>
                                    <ComboBoxItem Content="Light"/>
                                    <ComboBoxItem Content="Comic"/>
                                    <ComboBoxItem Content="Sepia"/>
                                    <ComboBoxItem Content="HighContrast"/>
                                </ComboBox>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0" VerticalAlignment="Center">
                                <TextBlock Text="Brillo" Foreground="{StaticResource MutedText}" Width="140" VerticalAlignment="Center"/>
                                <Slider Width="240" Minimum="0" Maximum="2" Value="{Binding Brightness}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0" VerticalAlignment="Center">
                                <TextBlock Text="Contraste" Foreground="{StaticResource MutedText}" Width="140" VerticalAlignment="Center"/>
                                <Slider Width="240" Minimum="0" Maximum="2" Value="{Binding Contrast}"/>
                            </StackPanel>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="Rendimiento">
                        <StackPanel Margin="6">
                            <TextBlock Text="Rendimiento" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,12"/>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="Caché de páginas (LRU)" Foreground="{StaticResource MutedText}" Width="220"/>
                                <TextBox Width="80" Text="{Binding PageCacheLimit}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="Ventana de prefetch" Foreground="{StaticResource MutedText}" Width="220"/>
                                <TextBox Width="80" Text="{Binding PrefetchWindow}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="Scroll suave" Foreground="{StaticResource MutedText}" Width="220"/>
                                <CheckBox IsChecked="{Binding SmoothScrolling}" Style="{StaticResource ToggleSwitch}"/>
                            </StackPanel>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="Archivos">
                        <StackPanel Margin="6">
                            <TextBlock Text="Archivos" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,12"/>
                            <TextBlock Text="Historial de lectura" Foreground="{StaticResource MutedText}"/>
                            <Button Content="Limpiar historial" Width="160" Click="ClearHistory_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                            <Separator Margin="0,10,0,10"/>
                            <TextBlock Text="Exportar/Importar configuración" Foreground="{StaticResource MutedText}" Margin="0,0,0,8"/>
                            <StackPanel Orientation="Horizontal" >
                                <Button Content="Exportar" Width="140" Margin="0,0,10,0" Click="ExportSettings_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                                <Button Content="Importar" Width="140" Click="ImportSettings_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                            </StackPanel>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="Avanzado">
                        <StackPanel Margin="6">
                            <TextBlock Text="Avanzado" FontWeight="Bold" FontSize="16" Foreground="White" Margin="0,0,0,12"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Retraso overlay (seg)" Foreground="{StaticResource MutedText}" Width="240"/>
                                <TextBox Width="80" Text="{Binding HideOverlayDelaySeconds}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Paso scroll por tecla" Foreground="{StaticResource MutedText}" Width="240"/>
                                <TextBox Width="80" Text="{Binding PageScrollStepRatio}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <TextBlock Text="Invertir rueda" Foreground="{StaticResource MutedText}" Width="240"/>
                                <CheckBox IsChecked="{Binding InvertScrollWheel}" Style="{StaticResource ToggleSwitch}"/>
                            </StackPanel>
                        </StackPanel>
                    </TabItem>
                </TabControl>

                <!-- ACTIONS -->
                <StackPanel Orientation="Horizontal" Grid.Row="2" HorizontalAlignment="Right" Margin="0,12,0,0">
                    <Button x:Name="ApplyButton" Content="Aplicar" Click="Apply_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                    <Button x:Name="CancelButton" Content="Cancelar" Click="Cancel_Click" Style="{StaticResource SecondaryButtonStyle}"/>
                    <Button x:Name="OkButton" Content="Aceptar" Click="Ok_Click" Style="{StaticResource PrimaryButtonStyle}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>