<Window x:Class="ComicReader.Views.ComicSearchWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="BÃºsqueda Avanzada de CÃ³mics" 
        Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        
        <Style TargetType="Button" x:Key="ModernButton">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#45a049"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TÃ­tulo -->
        <TextBlock Grid.Row="0" Text="ðŸ” BÃºsqueda Avanzada de CÃ³mics" 
                   FontSize="24" FontWeight="Bold" 
                   Foreground="#2196F3" 
                   HorizontalAlignment="Center" 
                   Margin="0,0,0,20"/>

        <!-- Panel de bÃºsqueda -->
        <GroupBox Grid.Row="1" Header="Criterios de BÃºsqueda" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Campo de bÃºsqueda -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,10">
                    <TextBlock Text="Buscar:" VerticalAlignment="Center" Width="80"/>
                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                             Width="400" Height="30" FontSize="14" Margin="10,0"/>
            <Button x:Name="SearchButton" Content="ðŸ” Buscar" 
                            Style="{StaticResource ModernButton}"
                IsDefault="True"
                            Click="SearchButton_Click"/>
                    <Button Content="ðŸ—‘ï¸ Limpiar" 
                            Background="#FF5722" 
                            Style="{StaticResource ModernButton}"
                            Click="ClearSearch_Click"/>
                </StackPanel>

                <!-- Opciones de bÃºsqueda -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10">
                    <TextBlock Text="Buscar en:" VerticalAlignment="Center" Width="80"/>
                    <CheckBox Content="TÃ­tulo" IsChecked="{Binding SearchInTitle}" Margin="10,0"/>
                    <CheckBox Content="Autor" IsChecked="{Binding SearchInAuthor}" Margin="10,0"/>
                    <CheckBox Content="Etiquetas" IsChecked="{Binding SearchInTags}" Margin="10,0"/>
                    <CheckBox Content="Contenido OCR" IsChecked="{Binding SearchInContent}" Margin="10,0"/>
                </StackPanel>

                <!-- Indicador de bÃºsqueda -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" 
                           Visibility="{Binding IsSearching, Converter={StaticResource BoolToVisConverter}}"
                           Margin="0,10">
                    <ProgressBar IsIndeterminate="True" Width="200" Height="20" Margin="80,0,10,0"/>
                    <TextBlock Text="Buscando..." VerticalAlignment="Center" FontStyle="Italic"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Resultados de bÃºsqueda -->
        <GroupBox Grid.Row="2" Header="Resultados de BÃºsqueda">
            <ListView x:Name="ResultsList" ItemsSource="{Binding SearchResults}" 
                      SelectionMode="Single" KeyDown="ResultsList_KeyDown">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="ðŸ“š TÃ­tulo" Width="300">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Title}" 
                                               FontWeight="Medium"
                                               TextTrimming="CharacterEllipsis"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        
                        <GridViewColumn Header="ðŸ“ Ruta" Width="250">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding FilePath}" 
                                               FontSize="10"
                                               Foreground="Gray"
                                               TextTrimming="CharacterEllipsis"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        
                        <GridViewColumn Header="ðŸ“ TamaÃ±o" Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding FileSizeFormatted}" 
                                               HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        
                        <GridViewColumn Header="ðŸ“… Modificado" Width="120">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding LastModified, StringFormat='dd/MM/yyyy'}" 
                                               FontSize="10"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        
                        <GridViewColumn Header="ðŸŽ¯ Coincidencia" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding MatchReason}" 
                                               FontSize="10"
                                               Foreground="Orange"
                                               FontWeight="Bold"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
                
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <EventSetter Event="MouseDoubleClick" Handler="OpenResult_Click"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E3F2FD"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </GroupBox>

        <!-- Panel inferior -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <TextBlock Text="{Binding SearchResults.Count, StringFormat='Resultados encontrados: {0}'}" 
                       VerticalAlignment="Center" 
                       FontWeight="Medium" 
                       Margin="0,0,20,0"/>
            <Button Content="âŒ Cerrar" 
                    Background="#757575" 
                    Style="{StaticResource ModernButton}"
                    IsCancel="True" 
                    Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>